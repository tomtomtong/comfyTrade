<!DOCTYPE html>
<html>
<head>
    <title>Symbol Input Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #2b2b2b;
            color: #e0e0e0;
            padding: 20px;
        }
        
        .test-section {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        .symbol-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .symbol-input {
            flex: 1;
            padding: 8px 35px 8px 12px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #333;
            color: #e0e0e0;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .symbol-input:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .symbol-dropdown-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            padding: 4px;
            border-radius: 2px;
        }

        .quick-symbols {
            display: flex;
            gap: 5px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .quick-symbol-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .quick-symbol-btn:hover {
            background: #45a049;
        }

        button {
            background: #555;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #666;
        }

        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .status.success {
            background: #2e7d32;
        }

        .status.error {
            background: #d32f2f;
        }
    </style>
</head>
<body>
    <h1>Symbol Input Fix Test</h1>
    
    <div class="test-section">
        <h3>Test: Symbol Input with Quick Symbols</h3>
        <div id="testContainer"></div>
        <div id="quickSymbolsContainer"></div>
        <p>Current Value: <span id="currentValue">-</span></p>
        <button onclick="testTyping()">Test Typing</button>
        <button onclick="removeSymbol()">Remove EURUSD</button>
        <button onclick="addSymbol()">Add XAUUSD</button>
        <button onclick="resetSymbols()">Reset Symbols</button>
        <div id="status" class="status" style="display: none;"></div>
    </div>

    <script src="config.js"></script>
    <script src="quick-symbols.js"></script>
    <script src="symbol-input.js"></script>
    <script>
        let testSymbolInput;
        
        // Mock MT5 API for testing
        window.mt5API = {
            getSymbols: async () => {
                return {
                    success: true,
                    data: [
                        { name: 'EURUSD', description: 'Euro vs US Dollar', currency_base: 'EUR', currency_profit: 'USD', digits: 5 },
                        { name: 'GBPUSD', description: 'British Pound vs US Dollar', currency_base: 'GBP', currency_profit: 'USD', digits: 5 },
                        { name: 'USDJPY', description: 'US Dollar vs Japanese Yen', currency_base: 'USD', currency_profit: 'JPY', digits: 3 },
                        { name: 'XAUUSD', description: 'Gold vs US Dollar', currency_base: 'XAU', currency_profit: 'USD', digits: 2 }
                    ]
                };
            }
        };
        
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
        
        // Initialize symbol input
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('testContainer');
            testSymbolInput = new SymbolInput(container, {
                placeholder: 'Enter symbol (e.g., EURUSD)',
                onSymbolSelect: (symbol, symbolData) => {
                    console.log('Selected symbol:', symbol, symbolData);
                    updateValue();
                },
                onSymbolChange: (symbol) => {
                    console.log('Symbol changed:', symbol);
                    updateValue();
                }
            });
            
            // Store globally like in the main app
            window.tradeSymbolInput = testSymbolInput;
            
            // Create quick symbols
            const quickContainer = document.getElementById('quickSymbolsContainer');
            QuickSymbols.create(quickContainer, (symbol) => {
                testSymbolInput.setValue(symbol);
                updateValue();
            });
            
            updateValue();
        });
        
        function updateValue() {
            const value = testSymbolInput ? testSymbolInput.getValue() : 'Not initialized';
            document.getElementById('currentValue').textContent = value;
        }
        
        function testTyping() {
            if (testSymbolInput) {
                testSymbolInput.focus();
                showStatus('Input focused. Try typing now.');
            }
        }
        
        function removeSymbol() {
            AppConfig.removeQuickSymbol('EURUSD');
            updateQuickSymbols();
            showStatus('Removed EURUSD. Try typing in the input now.');
        }
        
        function addSymbol() {
            AppConfig.addQuickSymbol('XAUUSD');
            updateQuickSymbols();
            showStatus('Added XAUUSD');
        }
        
        function resetSymbols() {
            AppConfig.quickSymbols = ['EURUSD', 'GBPUSD', 'USDJPY', 'AUDUSD', 'USDCAD'];
            AppConfig.saveToLocalStorage();
            updateQuickSymbols();
            showStatus('Reset symbols to defaults');
        }
        
        function updateQuickSymbols() {
            const quickContainer = document.getElementById('quickSymbolsContainer');
            QuickSymbols.update(quickContainer);
        }
    </script>
</body>
</html>